# Olympus Setup Guide

**Installation and Development Workflow for Olympus v0.5.1**

---

## Prerequisites

### Required
- **Node.js**: v18+ (ES2022+ target)
  - Download: https://nodejs.org/
  - Verify: `node --version`
- **pnpm**: v10+
  - Install: `npm install -g pnpm`
  - Verify: `pnpm --version`
- **Git**: For cloning and version control

### Optional (Feature-Specific)
- **Telegram Bot Token**: For Telegram bot integration
  - Get from: BotFather on Telegram
  - Used by: `packages/telegram-bot`
- **OpenAI API Key**: For Codex CLI features
  - Get from: https://platform.openai.com/api-keys
  - Set: `OPENAI_API_KEY` environment variable
- **Gemini CLI**: For GeminiAdvisor features
  - Install: `npm install -g @google/gemini-cli`
  - OAuth: Run `gemini` and authenticate
- **Build Tools** (for native modules):
  - **macOS**: `xcode-select --install` (Xcode Command Line Tools)
  - **Linux**: `sudo apt install build-essential python3`
  - **Windows**: Not currently supported (contributions welcome)

---

## Installation

### 1. Clone Repository
```bash
git clone <repo-url>
cd olympus
```

### 2. Install Dependencies
```bash
pnpm install
```

This installs all workspace packages and their dependencies using pnpm's link-based workspace algorithm.

### 3. Build All Packages
```bash
pnpm build
```

This builds all 9 packages in dependency order (resolved by Turbo):
1. `protocol` (0 dependencies)
2. `core` (← protocol)
3. `client` (← protocol)
4. `gateway` (← core, protocol)
5. `tui` (← client, protocol)
6. `web` (← client, protocol) — Vite build
7. `codex` (← protocol, core)
8. `telegram-bot` (← protocol)
9. `cli` (← all packages) — Final executable
10. `claude-dashboard` — Standalone build (esbuild)

**Build Verification**:
- All packages compile successfully
- No TypeScript errors
- Output in `dist/` directory for each package

### 4. Create Global CLI Symlink

The `install.sh` script handles this automatically, but if installing manually:

```bash
NPM_BIN_DIR="$(npm prefix -g)/bin"
ln -sf "$PWD/packages/cli/dist/index.js" "$NPM_BIN_DIR/olympus"
```

**Why symlink?** `npm link` fails on this project. Direct symlink is more reliable.

### 5. Run install.sh (Recommended)

For a fully configured setup with MCP servers, plugins, and skills:

```bash
# Global mode (all projects get Team Engineering Protocol support)
./install.sh

# Or local mode (just this project)
./install.sh --local

# With ~/.claude/CLAUDE.md managed block
./install.sh --with-claude-md
```

The installer will:
- Verify Node.js, npm, pnpm
- Check build tools (Xcode CLI / build-essential)
- Install/update CLI tools (Claude, Olympus, Gemini, Codex)
- Set up MCP servers (ai-agents, openapi, stitch)
- Install plugins and skills
- Create `.mcp.json` (local mode) or symlinks (global mode)
- Generate `.claude/settings.json`
- Configure Gemini 3 with preview features

---

## Configuration

### Environment Variables

Create `.env` in the monorepo root (if needed):

```bash
# Gateway
GATEWAY_PORT=8200
GATEWAY_API_KEY=your-api-key-here

# Dashboard
DASHBOARD_PORT=8201

# Telegram Bot
TELEGRAM_BOT_TOKEN=your-bot-token

# OpenAI / Codex
OPENAI_API_KEY=sk-...

# Optional: Adjust CLI concurrency (default: 5)
OLYMPUS_MAX_CONCURRENT_CLI=5
```

### Key Config Files

#### `.mcp.json` (Local Mode)
Auto-generated by `install.sh --local`. Portable, commit-safe:
```json
{
  "mcpServers": {
    "ai-agents": {
      "command": "node",
      "args": ["${PWD}/orchestration/mcps/ai-agents/server.js"]
    },
    "openapi": {
      "command": "node",
      "args": ["${PWD}/orchestration/mcps/openapi/server.js"]
    },
    "stitch": {
      "command": "npx",
      "args": ["-y", "@anthropic-ai/stitch-mcp"]
    }
  }
}
```

#### `~/.claude/settings.json` (Global Mode)
Auto-generated by `install.sh`. Includes plugins and MCP servers.

#### `pnpm-workspace.yaml`
Defines workspace packages:
```yaml
packages:
  - packages/*
```

#### `turbo.json`
Turbo build pipeline:
- `build`: Compiles packages (outputs in `dist/`)
- `test`: Runs tests (depends on build)
- `lint`: TypeScript type checking
- `dev`: Watch mode (no cache, persistent)

---

## Development Workflow

### Full Pipeline

```bash
# Build all packages in order
pnpm build

# Run all tests
pnpm test

# Type check all packages
pnpm lint

# Watch mode (all packages)
pnpm dev
```

### Individual Package

```bash
# Build a specific package
pnpm --filter @olympus-dev/gateway build

# Test a specific package
pnpm --filter @olympus-dev/gateway test

# Watch mode for a package
pnpm --filter @olympus-dev/web dev

# NOTE: CLI package is named 'olympus-dev', not '@olympus-dev/cli'
pnpm --filter olympus-dev build
```

### Package Filter Syntax

```bash
# By package name (without @scope)
pnpm --filter gateway build

# By location
pnpm --filter "./packages/gateway" build

# Multiple packages
pnpm --filter "gateway|codex" test

# All except
pnpm --filter "!cli" build
```

### Watch Mode Details

```bash
pnpm dev
```

This runs all packages in watch mode:
- TypeScript: Incremental compilation
- Vite (web): Hot Module Replacement (HMR)
- Dashboard: Auto-reload on file change
- No caching (cache: false in turbo.json)

**Limitation**: ESM environment means `vi.spyOn(cp, 'spawn')` doesn't work in tests. Focus on pure function testing.

---

## Running Olympus

### Full Server (Gateway + Dashboard + Telegram)

```bash
olympus server start
```

Starts all services:
- **Gateway**: API server (port 8200 by default)
- **Dashboard**: Web UI (port 8201 by default)
- **Telegram Bot**: Bot integration
- **LocalContextStore**: Initialized for project analysis
- **GeminiAdvisor**: Optional (if Gemini CLI available)

### Individual Components

```bash
# Claude CLI in foreground (PTY mode with TUI)
olympus start

# Claude CLI with auto-approval
olympus start-trust

# Gateway API only
olympus gateway start

# Dashboard only (requires Gateway running)
olympus dashboard

# Telegram bot only
olympus telegram
```

### CLI Commands

| Command | Description |
|---------|-------------|
| `olympus` | Start Claude CLI (shorthand for `start`) |
| `olympus start` | Claude CLI in foreground (PTY mode) |
| `olympus start-trust` | Claude CLI with `--dangerously-skip-permissions` |
| `olympus setup` | First-time configuration wizard |
| `olympus quickstart` | Setup + immediately start server |
| `olympus config` | Edit configuration interactively |
| `olympus models` | Manage Claude models |
| `olympus tui` | Terminal UI dashboard |
| `olympus server start` | Full server (Gateway + Dashboard + Telegram) |
| `olympus server stop` | Stop server |
| `olympus server status` | Check server status |
| `olympus curl <path>` | HTTP request to Gateway (auto API key) |

---

## Build Pipeline Details

### Build Dependency Graph

```
protocol → core → gateway → cli
    ↓        ↓       ↑        ↑
  client → tui ─────┘────────┘
    ↓
  web (Vite → 321KB JS + 31.6KB CSS)

codex → cli
telegram-bot → cli
claude-dashboard (standalone)
```

### Build Output Sizes

| Package | Size | Format |
|---------|------|--------|
| gateway | 218KB | TypeScript → JavaScript |
| cli | 67KB | Bundled executable |
| core | 79KB | Core utilities |
| web | 351KB | JavaScript + CSS (Vite) |
| codex | 92KB | Codex Orchestrator |
| client | 54KB | WebSocket client |
| protocol | 18KB | TypeScript interfaces |
| tui | 43KB | Terminal UI |
| telegram-bot | 38KB | Telegram integration |
| claude-dashboard | 65KB | Dashboard plugin (esbuild) |

### Turbo Configuration

`turbo.json` specifies:
- **Task dependencies**: What must build before tests
- **Caching**: `build` outputs cached, `dev` not cached
- **Parallelism**: Runs 4 tasks concurrently (default)

To inspect build graph:
```bash
pnpm turbo build --graph
```

---

## Testing

### Test Suite Overview

| Package | Count | Framework | Notes |
|---------|-------|-----------|-------|
| gateway | 346 | vitest | HTTP API + WebSocket + Workers |
| cli | 105 | vitest | CLI commands + PTY Worker |
| codex | 68 | vitest | Codex session management + orchestrator |
| telegram-bot | 57 | vitest | Telegram integration |
| core | 61 | vitest | Context store + extractor |
| web | 18 | vitest | Dashboard components |
| client | 8 | vitest | WebSocket client |
| protocol | 8 | vitest | Type checking |
| **Total** | **586** | | |

### Running Tests

```bash
# All tests
pnpm test

# Single package
pnpm --filter @olympus-dev/gateway test

# Watch mode
pnpm --filter @olympus-dev/gateway test:watch

# CLI (no tests yet, passes)
pnpm --filter olympus-dev test

# With coverage (configure in vitest.config.ts if needed)
pnpm test -- --coverage
```

### Test Configuration

Each package has `vitest.config.ts`:
- **Test files**: `src/**/*.test.ts` or `src/**/*.spec.ts`
- **Environment**: Node.js (node preset)
- **Dependencies**: Runs after `build` task

### ESM Testing Caveat

In ESM environment, `vi.spyOn(cp, 'spawn')` doesn't work. Instead:
- Test pure functions directly
- Mock at module boundaries (use import mocks)
- Use actual spawn for integration tests

Example:
```typescript
// ✅ Works: Pure function
test('formatCliOutput', () => {
  const result = formatCliOutput(rawOutput);
  expect(result).toBe(expected);
});

// ❌ Fails: Can't spy on spawn in ESM
// vi.spyOn(cp, 'spawn');

// ✅ Workaround: Test via integration or use spyOnModule
```

---

## Linting & Type Checking

### TypeScript Lint

```bash
pnpm lint
```

This runs `tsc --noEmit` on all 6 packages with lint enabled:
- `protocol`, `core`, `gateway`, `codex`, `telegram-bot`, `web`

Checks:
- Type correctness
- No unused variables
- Strict mode enabled

### Per-Package

```bash
pnpm --filter @olympus-dev/gateway lint
```

### Key TypeScript Settings

**CLI Package** (`packages/cli/tsconfig.json`):
```json
{
  "jsx": "react-jsx",
  "esModuleInterop": true,
  "module": "esnext"
}
```

This enables Ink/React TSX for terminal UI components.

---

## Dashboard Development

### Dev Server

```bash
cd packages/web
pnpm dev
```

- **Port**: 5173 (Vite default)
- **Hot reload**: Enabled (HMR)
- **CORS**: Gateway on port 8200 (configured in Gateway)

### Build

```bash
pnpm --filter @olympus-dev/web build
```

Output: `packages/web/dist/` (static assets, 351KB total)

### CORS Configuration

After Gateway changes, restart Gateway for dashboard to reflect:
```bash
# Terminal 1
olympus server start

# Terminal 2
cd packages/web
pnpm dev
```

Dashboard connects to Gateway WebSocket on `ws://localhost:8200`.

### Server-Side Config Injection

Gateway injects config into HTML via:
```javascript
window.__OLYMPUS_CONFIG__ = { port: 8200, ... }
```

This is set server-side before serving `index.html`.

---

## Troubleshooting

### Installation Issues

| Issue | Solution |
|-------|----------|
| `npm link` fails | Use `install.sh` (creates direct symlink instead) |
| `pnpm install` slow on first run | Normal for monorepo setup. Use `pnpm install --frozen-lockfile` for CI. |
| `node-pty` build fails | Install Xcode CLI (`xcode-select --install`) or build-essential (`apt install build-essential python3`) |
| `better-sqlite3` build fails | Native module. Verify Python 3 is installed. |

### Build Issues

| Issue | Solution |
|-------|----------|
| `pnpm build` fails midway | Check dependency order in output. May need to build one package: `pnpm --filter protocol build` |
| TypeScript errors in web | Ensure `jsx: react-jsx` in `packages/cli/tsconfig.json`. |
| Package not found | Check `pnpm-workspace.yaml` includes it. Run `pnpm ls` to verify. |
| Wrong filter syntax | Use exact package name or path: `pnpm --filter gateway` or `pnpm --filter ./packages/gateway` |

### Runtime Issues

| Issue | Solution |
|-------|----------|
| CLI permission denied | Run `chmod +x packages/cli/dist/index.js` or use `install.sh --local` |
| Gateway API key error | Set `GATEWAY_API_KEY` or check `olympus config` |
| Dashboard CORS error | Verify Gateway running on port 8200. Check firewall. Restart Gateway. |
| WebSocket connection fails | Ensure Gateway is running. Check port 8200 is not blocked. |
| Telegram bot not responding | Verify `TELEGRAM_BOT_TOKEN` is set. Check Gateway is running. |

### CLI Execution

| Issue | Solution |
|-------|----------|
| `olympus command not found` | Run `./install.sh` to create symlink. Verify `$PATH` includes npm bin directory. |
| PTY mode crashes | Use `olympus start-trust` to skip permissions. Check node-pty native module is built. |
| "spawn helper" permission error | `ensureSpawnHelperPermissions()` auto-fixes. If not, run `chmod +x orchestration/spawn-helper/*`. |
| Claude CLI not found | Install: `npm install -g @anthropic-ai/claude-code` |

---

## Project Structure

```
olympus/
├── packages/
│   ├── protocol/          # TypeScript interfaces (13 files)
│   ├── core/              # Utilities: logger, launcher, context (18 files)
│   ├── gateway/           # HTTP API + WebSocket server (65 files)
│   ├── cli/               # CLI executable + Ink TUI (42 files)
│   ├── client/            # WebSocket client library (12 files)
│   ├── web/               # Dashboard (Vite, React) (35 files)
│   ├── tui/               # Terminal UI (15 files)
│   ├── codex/             # Codex Orchestrator (38 files)
│   ├── telegram-bot/      # Telegram integration (22 files)
│   └── claude-dashboard/  # Status line plugin (8 files)
├── orchestration/
│   ├── mcps/
│   │   ├── ai-agents/     # MCP: Agent coordination
│   │   └── openapi/       # MCP: Swagger/OpenAPI
│   ├── commands/
│   │   ├── team.md        # /team slash command (490 lines)
│   │   └── agents.md      # /agents slash command
│   ├── skills/
│   │   ├── frontend-ui-ux/
│   │   ├── git-master/
│   │   └── agent-browser/
│   ├── templates/
│   │   ├── CLAUDE.global.md
│   │   ├── CODEX.global.md
│   │   └── GEMINI.global.md
│   └── spawn-helper/      # Native binary for spawning
├── .claude/
│   └── agents/            # 19 Custom Agents (roles, domain-specific behavior)
├── docs/
│   ├── operations/        # Setup guides, operational docs
│   ├── architecture/      # Design docs, patterns
│   └── api/               # API documentation
├── install.sh             # Main installer (1090 lines)
├── turbo.json             # Build pipeline
├── pnpm-workspace.yaml    # Workspace config
└── package.json           # Monorepo manifest
```

---

## Next Steps

After completing setup:

### 1. Verify Installation
```bash
olympus --version
olympus config
pnpm test
```

### 2. Start Development
```bash
# Terminal 1: Gateway + Dashboard
olympus server start

# Terminal 2: Claude CLI (or use "olympus start" separately)
claude
```

### 3. Use Team Engineering Protocol
```bash
# In Claude code, run:
/team "Your task description"
```

### 4. Read Documentation
- **API**: Check `packages/gateway/README.md` for endpoint details
- **Architecture**: Read `docs/architecture/` for design patterns
- **Team Protocol**: See `orchestration/commands/team.md` for v3.2 features

---

## Quick Reference

### Common Commands

```bash
# Development
pnpm dev              # Watch all packages
pnpm build            # Build all
pnpm test             # Test all
pnpm lint             # Type check all

# Running Olympus
olympus               # Start Claude CLI
olympus server start  # Full server (Gateway + Dashboard + Telegram)
olympus curl /api/health  # Health check

# Single Package
pnpm --filter gateway build
pnpm --filter gateway test:watch
pnpm --filter web dev

# Installation
./install.sh          # Interactive (global or local)
./install.sh --local  # Project-only setup
```

### Ports

| Service | Port | Command |
|---------|------|---------|
| Gateway | 8200 | `olympus gateway start` |
| Dashboard | 8201 | `olympus dashboard` |
| Web Dev | 5173 | `pnpm -C packages/web dev` |
| Vite | 5174 | (fallback) |

### Environment

| Variable | Default | Purpose |
|----------|---------|---------|
| `GATEWAY_PORT` | 8200 | HTTP API port |
| `GATEWAY_API_KEY` | (none) | Authentication key |
| `DASHBOARD_PORT` | 8201 | Web UI port |
| `TELEGRAM_BOT_TOKEN` | (none) | Telegram bot token |
| `OPENAI_API_KEY` | (none) | Codex API key |
| `OLYMPUS_MAX_CONCURRENT_CLI` | 5 | CLI concurrency limit |

---

## Getting Help

### Documentation
- **Architecture**: `docs/architecture/`
- **API Reference**: `docs/api/`
- **Operations**: `docs/operations/`
- **Memory**: `~/.claude/projects/.../memory/MEMORY.md` (project-specific context)

### Code Examples
- **Gateway tests**: `packages/gateway/src/__tests__/`
- **CLI commands**: `packages/cli/src/commands/`
- **Integrations**: `packages/telegram-bot/src/`

### Debugging
```bash
# Verbose output
DEBUG=olympus:* olympus start

# Gateway logs
olympus server start 2>&1 | tee gateway.log

# Test with coverage
pnpm --filter @olympus-dev/gateway test -- --coverage
```

### Issues & Contributions
- **GitHub**: https://github.com/jobc90/olympus/issues
- **Project Memory**: `.claude/projects/*/memory/` (preserved across sessions)

---

## Version Information

- **Olympus**: v0.5.1
- **Node.js**: v18+ (ES2022)
- **pnpm**: v10+
- **TypeScript**: ^5.8.0
- **Turbo**: ^2.5.0
- **Vite**: ^5.x (web)
- **vitest**: ^3.0.0 (tests)

---

**Last Updated**: February 16, 2026
**Maintainer**: Olympus Team
